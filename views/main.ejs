<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
        <link rel="stylesheet" href="styles.css">
        <link rel="icon" href="img/favicon.png">
        <title>Stay alive</title>
    </head>
    <body>
        <header>
            <div class="header-panel">
                <h1><a href="/main" class="logo">Stay alive</a></h1>
                <div class="log-out"><a href="/logout">Log out</a></div>
            </div>
        </header>
        <main>
            <div class="main-section">
                <div>
                    <ul class="users-tubular">
                        <li><button type="button" class="button button--block" onclick="updateStatus('inactive')">Block</button></li>
                        <li><button type="button" class="button button--unblock" onclick="updateStatus('active')">Unblock</button></li>
                        <li><button type="button" class="button button--delete" onclick="deleteUser()">Delete</button></li>
                    </ul>
                </div>
                <div class="users-table table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <td class="checkbox"><label for="allCheckbox"><input type="checkbox" id="allCheckbox" name="allCheckbox" value="value"/></label></td>
                                <td class="id">ID</td>
                                <td class="name">Name</td>
                                <td class="mail">E-mail</td>
                                <td class="registration-date">Registration date</td>
                                <td class="last-login-date">Last login date</td>
                                <td class="status">Status</td>
                            </tr>
                        </thead>
                        <tbody>
                            <% users.forEach(user => { %>
                                <tr>
                                    <td class="checkbox"><label for="userCheckbox"><input type="checkbox" id="userCheckbox" name="userCheckbox" value="<%= user.id %>"/></label></td>
                                    <td class="id"><%= user.id %></td>
                                    <td class="name"><%= user.name %></td>
                                    <td class="mail"><%= user.email %></td>
                                    <td class="registration-date"><%= user.registration_date %></td>
                                    <td class="last-login-date"><%= user.last_login_date %></td>
                                    <td class="status"><%= user.status %></td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
        <footer>
            <div class="footer-block">
                <div class="footer-text">
                    Made by Valeriya Kuznetsova as part of training at iTransition
                </div>
                <div class="footer-year">
                    2023
                </div>
            </div>
        </footer>

<script>
    function updateStatus(action) {
        const selectedUsers = Array.from(document.querySelectorAll('input[name="userCheckbox"]:checked'))
            .map(checkbox => checkbox.value);

        if (selectedUsers.length > 0) {
            console.log(JSON.stringify({ action, userIds: selectedUsers }));
            fetch('/update-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ action, userIds: selectedUsers }),
            })
            .then(response => response.json())
            .then(responseData => {
                if (responseData.success) {
                    location.reload();
                }
            })
            .catch(error => {
                console.log('Error');
            });
        }
    }

    function deleteUser() {
        const selectedUsers = Array.from(document.querySelectorAll('input[name="userCheckbox"]:checked'))
            .map(checkbox => checkbox.value);

        if (selectedUsers.length > 0) {
            fetch('/delete-users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userIds: selectedUsers }),
            })
            .then(response => response.json())
            .then(responseData => {
                if (responseData.success) {
                    location.reload();
                }
            })
            .catch(error => {
                console.log('Error');
            });
        }
    }

    const selectAllCheckbox = document.getElementById('allCheckbox');
    
    const userCheckboxes = document.querySelectorAll('input[name="userCheckbox"]');
  
    selectAllCheckbox.addEventListener('change', function () {
      userCheckboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
      });
    });
  </script>
  

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    </body>
</html>